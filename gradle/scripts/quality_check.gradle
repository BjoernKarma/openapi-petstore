// Defines a list of paths that are excluded for calculating test coverage
// suppress test coverage report for generated-, exception- and spring-boilerplate-classes
def coverageExcludes = [
        '**/de/openapi/petstore/logging/**',
        '**/de/openapi/petstore/*.class',
        "**/autogenerated/**/*.*",
        '**/de.openapi.petstore.configuration/**',
        '**/exceptions/**',
        "**/config/**/*.*",
        "**/model/**/*.*",
        "**/exception/**/*.*",
        "**/de.openapi.petstore.db/**/*.*",
        "**/*Application.java"]

jacocoTestReport {
    dependsOn test
    reports {
        xml.required = true
        xml.outputLocation = file("${buildDir}/reports/jacocoTestReport.xml")
        csv.required = true
        html.required = true
        html.outputLocation = file("${buildDir}/reports/jacoco")
    }

    // suppress test coverage report for generated-, exception- and spring-boilerplate-classes
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it,
                    exclude: coverageExcludes
            )
        }))
    }
}

// -----------------------------
// OWASP DEPENDENCY CHECK PLUGIN
// -----------------------------

dependencyCheck {
    formats = ['HTML', 'JSON', 'XML']
}

// ---------------------------------------------------------
// SONARQUBE PLUGIN (using Jacoco and OWASP dependency check
// ---------------------------------------------------------

sonarqube {
    properties {
        property "sonar.projectBaseDir", "$rootProject.projectDir"
        property "sonar.language", "java"
        property "sonar.java.binaries", "**/classes"
        property "sonar.exclusions", coverageExcludes
        property "sonar.java.coveragePlugin", "jacoco"
        property "sonar.coverage.jacoco.xmlReportPaths", "$project.buildDir/reports/jacocoTestReport.xml"
        property "sonar.dependencyCheck.jsonReportPath", "$project.buildDir/reports/dependency-check-report.json"
        property "sonar.dependencyCheck.htmlReportPath", "$project.buildDir/reports/dependency-check-report.html"
    }
}